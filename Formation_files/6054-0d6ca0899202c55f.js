"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6054],{4262:(e,t,a)=>{a.d(t,{i:()=>d});var l=a(54568),n=a(7620),r=a(10369),s=a(23812),o=a(98304);let i=e=>{let{handleClose:t,title:a,description:n,inset:r,action:i}=e;return(0,l.jsxs)("div",{className:"border-border-300 shadow-sm w-[300px] max-w-full bg-bg-000 rounded-xl p-5 border relative",children:[(0,l.jsx)("div",{className:"text-left mb-2 font-medium text-sm",children:a}),(0,l.jsx)("p",{className:"mb-2 text-sm",children:n}),!!r&&(0,l.jsx)("div",{className:"flex flex-col rounded-md bg-text-000 bg-opacity-5 p-4 font-mono text-xs text-text-300",children:r}),i&&(0,l.jsx)("div",{className:"flex justify-end",children:(0,l.jsx)(s.$,{variant:"primary",className:"mt-4 text-sm",onClick:i.onClick,disabled:i.disabled,loading:i.loading,children:i.label})}),(0,l.jsx)("div",{className:"absolute top-2 right-2",children:(0,l.jsx)(s.$,{variant:"ghost",onClick:t,className:"h-9 w-9 !min-w-9",children:(0,l.jsx)(o.X,{})})})]})},d=e=>{var t,a,s;let{error:o,handleClose:d,sendMessage:c,isStreaming:u}=e,[f,m]=(0,n.useState)(!1),p=(0,r.A)(),h=function(e,t){switch(e.type){case"UnsupportedImports":return{title:t?t.formatMessage({defaultMessage:"Artifact failed to load",id:"NcDXiSfIPe"}):"Artifact failed to load",description:t?t.formatMessage({defaultMessage:"The generated artifact uses libraries we don’t support:",id:"HG0Hu8xIQA"}):"The generated artifact uses libraries we don’t support:",inset:[...e.unsupportedModules,...e.nonExistentIcons.map(e=>"{ ".concat(e,' } from "lucide-react"'))],subtext:t?t.formatMessage({defaultMessage:"The code itself may still work. To use it, you’ll need a development setup with these libraries installed.",id:"Et/uvuRBba"}):"The code itself may still work. To use it, you’ll need a development setup with these libraries installed."};case"RuntimeError":return{title:t?t.formatMessage({defaultMessage:"Error running artifact",id:"JU2kK1J3jY"}):"Error running artifact",description:t?t.formatMessage({defaultMessage:"An error occurred while trying to run the generated artifact.",id:"3RpkNRAyPc"}):"An error occurred while trying to run the generated artifact.",inset:[e.message],insetStyle:"danger"};case"FileNotFound":return{title:t?t.formatMessage({defaultMessage:"File not found",id:"gcaJtRf4b0"}):"File not found",description:t?t.formatMessage({defaultMessage:"The file “{fileName}” could not be found.",id:"0kOCGtB3eN"},{fileName:e.fileName}):"The file “".concat(e.fileName,"” could not be found."),subtext:t?t.formatMessage({defaultMessage:"Please check the file name and try again.",id:"/fdYJU5SMC"}):"Please check the file name and try again."};case"ClaudeCompletionError":return{title:t?t.formatMessage({defaultMessage:"Error in Claude completion",id:"ya5HK9oB9T"}):"Error in Claude completion",description:e.message};case"ArtifactStorageError":return{title:t?t.formatMessage({defaultMessage:"Error accessing shared data",id:"hjqZygykww"}):"Error accessing shared data",description:e.message}}}(o.error,p),g="> ".concat(h.description,"\n  ").concat(null!=(s=null==(t=h.inset)?void 0:t.map(e=>"> `".concat(e,"`")).join("\n"))?s:"","\n  \n\n  Can you fix this error in `").concat(o.artifactId,"`?"),v=c?{label:p.formatMessage({defaultMessage:"Try fixing with Claude",id:"wrcoZ2Zo0b"}),onClick:()=>{m(!0),null==c||c({prompt:g,attachments:[],files:[],syncSources:[]})},disabled:u,loading:f}:void 0;return(0,l.jsx)("div",{className:"absolute bottom-5 left-5 right-5",children:(0,l.jsx)(i,{title:h.title,description:h.description,handleClose:d,inset:(null==(a=h.inset)?void 0:a.length)?h.inset?(0,l.jsx)("ul",{children:h.inset.map((e,t)=>(0,l.jsx)("li",{children:e},t))}):null:void 0,action:v})})}},46879:(e,t,a)=>{a.d(t,{A:()=>N});var l=a(54568),n=a(23812),r=a(3075),s=a(10369),o=a(59666);let i=e=>{let{isOpen:t=!1,filename:a,onClose:i,onConfirm:d}=e,c=(0,s.A)();return(0,l.jsxs)(r.aF,{title:c.formatMessage({defaultMessage:"Download file",id:"k9qHCCLPA5"}),isOpen:t,onClose:i,children:[(0,l.jsxs)("p",{className:"break-words flex flex-col gap-1 pt-3 text-sm",children:[(0,l.jsx)(o.A,{defaultMessage:"Artifacts are created by other users and aren’t verified by Anthropic. Only download files you trust.",id:"MDebIUeu03"}),(0,l.jsx)("pre",{className:"font-mono text-wrap text-sm p-2 my-2 rounded border border-border-400 bg-bg-000",children:a})]}),(0,l.jsxs)(r.vW,{children:[(0,l.jsx)(n.$,{variant:"secondary",onClick:i,children:(0,l.jsx)(o.A,{defaultMessage:"Cancel",id:"47FYwba+bI"})}),(0,l.jsx)(n.$,{onClick:d,children:(0,l.jsx)(o.A,{defaultMessage:"Download file",id:"k9qHCCLPA5"})})]})]})};var d=a(19094),c=a(64328),u=a(13750),f=a(21266),m=a(68067),p=a(7620);let h=e=>{let{isOpen:t=!1,onClose:a,onConfirm:i}=e,d=(0,s.A)(),[h,g]=(0,p.useState)(!1),v=(0,m.fS)("claude_create_pebble_stone"),{activeOrganization:y}=(0,c.YL)();return(0,p.useEffect)(()=>{!t||v&&(null==y?void 0:y.uuid)||a()},[t,v,null==y?void 0:y.uuid,a]),(0,l.jsxs)(r.aF,{title:d.formatMessage({defaultMessage:"Access shared data",id:"BgSBBhOmOQ"}),isOpen:t,onClose:a,children:[(0,l.jsx)("p",{className:"break-words flex flex-col gap-1 pt-3 text-sm",children:(0,l.jsx)(f.YX,{id:"velvet_cupcake_spark"})}),(0,l.jsx)("div",{className:"mt-4 mb-2",children:(0,l.jsx)(u.Sc,{label:(0,l.jsx)("span",{className:"text-sm text-text-100",children:(0,l.jsx)(o.A,{defaultMessage:"Remember my choice for this session",id:"ihRWxb7Azt"})}),checked:h,onChange:g})}),(0,l.jsxs)(r.vW,{children:[(0,l.jsx)(n.$,{variant:"secondary",onClick:()=>a(h),children:(0,l.jsx)(o.A,{defaultMessage:"Deny",id:"htvX+Z11l+"})}),(0,l.jsx)(n.$,{onClick:()=>i(h),children:(0,l.jsx)(o.A,{defaultMessage:"Allow",id:"y/bmsG8rnv"})})]})]})};var g=a(44995),v=a(57291),y=a(56929),x=a(72902),b=a(39109),w=a(61295),C=a(19354),j=a(16159),k=a(86667),S=a(73356),M=a(97905);let N=(0,p.forwardRef)((e,t)=>{let{content:a,className:r,type:u,onSandboxConfirmation:f,onDOMContentLoaded:N,capabilities:A,onReportError:R,onSetContent:E,onRefresh:P,externalLinkBehavior:T,onOpenExternalLinkRequest:_,onTrackInteraction:Z,showLoginModal:L,lazy:O=!0,zoom:I=1,artifactContext:F,ArtifactMcpModal:H,isChatStreaming:D}=e,U=(0,s.A)(),{userContentRendererUrl:q}=(0,g._r)(),z=(0,m.fS)("claude_create_marble");(0,m.fS)("claudeai_anorak_senator_shoreline");let[B,G]=(0,p.useState)(!1),$=(0,p.useRef)(null),W="".concat(q).concat((null==F?void 0:F.uuid)&&"published_artifact"===F.type?"/artifact/"+F.uuid:""),K=window.location.hostname,X=new URLSearchParams;X.set("domain",K),R&&X.set("errorReportingMode","parent");let J=X.toString()?"".concat(W,"?").concat(X.toString()):W;(0,p.useEffect)(()=>{let e=$.current;if(e&&navigator.userAgent.toLowerCase().includes("firefox")){e.setAttribute("data-no-service-worker","true");let t=setTimeout(()=>{e.sandbox&&e.src&&(e.sandbox.value="allow-scripts allow-same-origin",e.setAttribute("referrerpolicy","no-referrer"))},0);return()=>clearTimeout(t)}},[]);let[Y,Q]=(0,p.useState)(null),[V,ee]=(0,p.useState)(null),[et,ea]=(0,p.useState)(null),[el,en]=(0,p.useState)(null),[er,es]=(0,p.useState)(null),[eo,ei]=(0,p.useState)([]),[ed,ec]=(0,p.useState)([]),{activeOrganization:eu}=(0,c.YL)(),ef=(0,p.useCallback)((e,t,a)=>D?new Promise((l,n)=>{let r={method:e,data:t,executeOperation:a,resolve:l,reject:n,artifactUuid:null==F?void 0:F.uuid};ec(e=>{var t;return(null==F?void 0:F.uuid)!==(e.length>0?null==(t=e[e.length-1])?void 0:t.artifactUuid:null)?[r]:[...e,r]})}):a(),[D,null==F?void 0:F.uuid,ec]),em=(0,m.fS)("apps_use_turmeric"),ep=(0,m.fS)("artifact_tailwind_styles"),[eh,eg]=(0,p.useState)(0),{sendRequest:ev,updatePermission:ey}=function(e){let{iframeRef:t,allowedOrigin:a,onRateLimited:l=null,initialPermissions:n,onPermissionRequested:r,onCapabilityAction:s}=e,[o,i]=(0,p.useState)(null),d=(0,p.useRef)(n),[c,u]=(0,p.useState)(0);(0,p.useEffect)(()=>{if(!t.current&&c<20){let e=setTimeout(()=>{u(e=>e+1)},500);return()=>clearTimeout(e)}if(!t.current)return void S.v.warn(S.u.ARTIFACTS,"Max retries reached while waiting for iframe");let e=new M.x({iframe:t.current,allowedOrigin:a,onRateLimited:l,onPermissionRequested:async e=>{if(C.tH.includes(e)||"accepted"===d.current[e])return"accepted";let t=await r(e);return d.current={...d.current,[e]:t},t},onCapabilityAction:s});return i(e),()=>{e.cleanup()}},[t,a,d,l,r,s,c]);let f=(0,p.useCallback)(async(e,t)=>{if(o)return o.sendRequest(e,t);throw Error("Communicator not initialized")},[o]),m=(0,p.useCallback)(()=>{null==o||o.restartListening()},[o]),h=(0,p.useCallback)((e,t)=>{d.current={...d.current,[e]:t}},[]);return{sendRequest:null===o?void 0:f,restartListening:m,permissions:d.current,updatePermission:h}}({iframeRef:$,allowedOrigin:q,onCapabilityAction:(0,p.useCallback)(async(e,t)=>{var a,l,n,r;if(e.method===C.uZ.ReadyForContent)return G(!0),null==f||f(),Promise.resolve();if(e.method===C.uZ.GetFile)return A&&A.getFile?{"@type":"type.googleapis.com/anthropic.claude.usercontent.sandbox.GetFileResponse",value:await A.getFile(e.payload.key)}:Promise.reject();if(e.method===C.uZ.SendConversationMessage)return A&&A.sendMessage?(await A.sendMessage({prompt:e.payload.message,attachments:[],files:[],syncSources:[]}),Promise.resolve()):Promise.reject();if(e.method===C.uZ.ClaudeCompletion)return A&&A.claudeComplete?(eg(e=>e+1),{"@type":"type.googleapis.com/anthropic.claude.usercontent.sandbox.ClaudeCompletionResponse",completion:await A.claudeComplete(e.payload.prompt)}):Promise.reject();if(e.method===C.uZ.StorageGet){if(!(null==A||null==(a=A.storage)?void 0:a.get))return Promise.reject();let t=A.storage.get,l=async()=>{let a=await t(e.payload.key,e.payload.shared);return a?{"@type":"type.googleapis.com/anthropic.claude.usercontent.sandbox.StorageGetResponse",key:a.key,value:a.value,shared:a.shared}:null};return ef("get",e.payload,l)}else if(e.method===C.uZ.StorageSet){if(!(null==A||null==(l=A.storage)?void 0:l.set))return Promise.reject();let t=A.storage.set,a=async()=>{let a=await t(e.payload.key,e.payload.value,e.payload.shared);return a?{"@type":"type.googleapis.com/anthropic.claude.usercontent.sandbox.StorageSetResponse",key:a.key,value:a.value,shared:a.shared}:null},n=async()=>!0===e.payload.shared?"allow"===el?a():"deny"===el?Promise.reject():new Promise((e,t)=>{ea({onConfirm:async()=>{try{let t=await a();e(t)}catch(e){t(e)}ea(null)}})}):a();return ef("set",e.payload,n)}else if(e.method===C.uZ.StorageDelete){if(!(null==A||null==(n=A.storage)?void 0:n.delete))return Promise.reject();let t=A.storage.delete,a=async()=>{let a=await t(e.payload.key,e.payload.shared);return a?{"@type":"type.googleapis.com/anthropic.claude.usercontent.sandbox.StorageDeleteResponse",key:a.key,deleted:a.deleted,shared:a.shared}:null},l=async()=>!0===e.payload.shared?"allow"===el?a():"deny"===el?Promise.reject():new Promise((e,t)=>{ea({onConfirm:async()=>{try{let t=await a();e(t)}catch(e){t(e)}ea(null)}})}):a();return ef("delete",e.payload,l)}else if(e.method===C.uZ.StorageList){if(!(null==A||null==(r=A.storage)?void 0:r.list))return Promise.reject();let t=A.storage.list,a=async()=>{let a=await t(e.payload.prefix,e.payload.shared);return a?{"@type":"type.googleapis.com/anthropic.claude.usercontent.sandbox.StorageListResponse",keys:a.keys,prefix:a.prefix,shared:a.shared}:null};return ef("list",e.payload,a)}else if(e.method===C.uZ.BroadcastContentSize);else if(e.method===C.uZ.DOMContentLoaded)return null==N||N(),Promise.resolve();else if(e.method===C.uZ.OpenExternal){if("ask"===T)return Q(e.payload.href),Promise.resolve();if("bubble"===T&&_)return _({href:e.payload.href}),Promise.resolve()}else if(e.method===C.uZ.DownloadFile)return ee(e.payload),Promise.resolve();else if(e.method===C.uZ.ReportError)return null==R||R(e.payload.error),Promise.resolve();else if(e.method===C.uZ.TrackInteraction)return null==Z||Z(e.payload),Promise.resolve();else if(e.method===C.uZ.ProxyFetch)return(null==eu?void 0:eu.uuid)?D?new Promise((a,l)=>{let n={data:e.payload,sendRequest:t,resolve:a,reject:l,artifactUuid:null==F?void 0:F.uuid};ei(e=>{var t;return(null==F?void 0:F.uuid)!==(e.length>0?null==(t=e[e.length-1])?void 0:t.artifactUuid:null)?[n]:[...e,n]})}):(0,j._)(e.payload,t,null==eu?void 0:eu.uuid,F,z,es):(null==L||L(),Promise.reject());return Promise.reject()},[f,N,A,G,R,eg,T,_,Z,L,null==eu?void 0:eu.uuid,F,z,D,el,ef]),onPermissionRequested:(0,p.useCallback)(async e=>e===C.uZ.ClaudeCompletion&&eh>=100?"denied":Promise.resolve("accepted"),[eh]),initialPermissions:{}});(0,p.useEffect)(()=>{eh>=100&&(ey(C.uZ.ClaudeCompletion,"denied"),(0,y.wd)("Claude completion request limit hit."))},[eh,ey]),(0,p.useEffect)(()=>{(async()=>{!D&&eo.length>0&&(null==eu?void 0:eu.uuid)&&(null==F?void 0:F.uuid)&&(await Promise.all(eo.map(async e=>{let{data:t,sendRequest:a,resolve:l,reject:n}=e;try{let e=await (0,j._)(t,a,eu.uuid,F,z,es);l(e)}catch(e){n(e)}})),ei([]))})()},[D,eo,null==eu?void 0:eu.uuid,F,z]),(0,p.useEffect)(()=>{(async()=>{!D&&ed.length>0&&(null==F?void 0:F.uuid)&&(await Promise.all(ed.map(async e=>{let{executeOperation:t,resolve:a,reject:l}=e;try{let e=await t();a(e)}catch(e){l(e)}})),ec([]))})()},[D,ed,F]);let ex=(0,p.useCallback)(()=>{(0,y.wd)("Claude completion modal confirmed"),eg(0),ey(C.uZ.ClaudeCompletion,"accepted")},[ey]),eb=(0,p.useCallback)(async()=>{let e=await (null==ev?void 0:ev(C.uZ.GetScreenshot,k.qs));if(null==e?void 0:e.screenshot){if(e.screenshot.length>0xa00000)throw Error(U.formatMessage({defaultMessage:"Screenshot too large",id:"ifBuzEbIz2"}));if(!/^data:image\/(png|jpeg|gif);base64,/.test(e.screenshot))throw Error(U.formatMessage({defaultMessage:"Invalid screenshot format",id:"KCmGxpLNuq"}));return e.screenshot}},[U,ev]),ew=(0,p.useCallback)(async()=>{let e=await (null==ev?void 0:ev(C.uZ.CopyHtmlContent,{"@type":"type.googleapis.com/anthropic.claude.usercontent.sandbox.CopyHtmlContentRequest"}));return null==e?void 0:e.reportHTMLContent},[ev]),eC=(0,p.useCallback)(async()=>{let e=await (null==ev?void 0:ev(C.uZ.GetDOMSnapshot,k.qs));return(null==e?void 0:e.domSnapshot)||void 0},[ev]);return(0,p.useEffect)(()=>{B&&a&&u&&(null==E||E(),Object.values(v.vU).includes(u)?null==ev||ev(C.uZ.SetContent,{content:a,type:u,tailwindStylesEnabled:ep,"@type":"type.googleapis.com/anthropic.claude.usercontent.sandbox.SandboxContent"}):null==ev||ev(C.uZ.SetContent,{content:a,type:u,tailwindStylesEnabled:ep,"@type":"type.googleapis.com/anthropic.claude.usercontent.sandbox.SandboxContent"}))},[a,ev,u,B,E,ep]),(0,p.useImperativeHandle)(t,()=>({refresh:()=>{null==P||P(),G(!1);let e=$.current;if(e){let t=e.parentNode;t?(t.removeChild(e),e.removeAttribute("src"),e.sandbox.value="allow-scripts allow-same-origin",e.setAttribute("data-no-service-worker","true"),e.setAttribute("referrerpolicy","no-referrer"),e.src=J,t.appendChild(e)):e.src=J}},getScreenshot:eb,copyHtmlContent:ew,getDOMSnapshot:eC})),(0,l.jsxs)("div",{className:(0,x.A)("relative",r),children:[(0,l.jsx)("iframe",{ref:$,className:"h-full w-full",style:{zoom:I},sandbox:"allow-scripts allow-same-origin",title:U.formatMessage({defaultMessage:"Claude content",id:"/Ma3teJf9/"}),loading:O?"lazy":void 0,src:J,allow:"fullscreen; clipboard-write",referrerPolicy:"no-referrer"}),(0,l.jsx)(b.N,{children:!B&&(0,l.jsx)(w.P.div,{className:"bg-bg-100 absolute inset-0 z-10",initial:{opacity:1},animate:{opacity:1},exit:{opacity:0},transition:{duration:.15,ease:"easeInOut"}})}),Y?(0,l.jsx)(d.v,{isOpen:!!Y,url:Y,onClose:()=>Q(null),onConfirm:()=>{Y&&window.open(Y,"_blank"),Q(null)}}):null,V?(0,l.jsx)(i,{isOpen:!!V,filename:V.filename,onClose:()=>ee(null),onConfirm:()=>{if(V){let e=new Blob([V.data],{type:V.mimeType}),t=URL.createObjectURL(e),a=document.createElement("a");a.href=t,a.download=V.filename,a.click(),URL.revokeObjectURL(t)}ee(null)}}):null,et?(0,l.jsx)(h,{isOpen:!!et,onClose:e=>{e&&en("deny"),ea(null)},onConfirm:async e=>{et&&(e&&en("allow"),await et.onConfirm())}}):null,er&&H&&F?(0,l.jsx)(H,{isOpen:!!er,requestedServers:er.requestedServers,onClose:()=>{er.onClose(),es(null)},artifactContext:F}):null,em&&eh>=100&&(0,l.jsx)("div",{className:"fixed inset-0 bg-always-black bg-opacity-50 flex items-center justify-center z-modal",children:(0,l.jsxs)("div",{className:"bg-bg-100 p-4 rounded shadow-lg",children:[(0,l.jsx)("p",{className:"text-fg-100 mb-4",children:(0,l.jsx)(o.A,{defaultMessage:"Many requests made. Acknowledge that you’re still here to continue.",id:"kmh/1AmVcl"})}),(0,l.jsx)(n.$,{onClick:ex,variant:"primary",children:(0,l.jsx)(o.A,{defaultMessage:"I’m still here",id:"NwhjMfjigc"})})]})})]})});N.displayName="RichSandbox"},49953:(e,t,a)=>{a.d(t,{Z:()=>r});var l=a(54568),n=a(7620);let r=(0,n.forwardRef)((e,t)=>{let{className:a,children:r,disabled:s,noDefaultScroll:o}=e,i=(0,n.useRef)(0),d=(0,n.useRef)(!0),c=(0,n.useRef)(null),u=(0,n.useCallback)(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"auto";if(c.current&&d.current&&!(c.current.scrollHeight-c.current.clientHeight<c.current.scrollTop)&&c.current&&"function"==typeof c.current.scrollTo){var t,a,l;null==(l=c.current)||l.scrollTo({top:(null==(t=c.current)?void 0:t.scrollHeight)-(null==(a=c.current)?void 0:a.clientHeight)+5,behavior:e})}},[]),f=(0,n.useCallback)(e=>{if(c.current&&c.current&&"function"==typeof c.current.scrollTo){var t,a,l;c.current.style.overflow="hidden",null==(l=c.current)||l.scrollTo({top:(null==(t=c.current)?void 0:t.scrollHeight)*e-(null==(a=c.current)?void 0:a.clientHeight)/2,behavior:"auto"})}},[]),m=(0,n.useCallback)(()=>{c.current&&(c.current.style.overflow="")},[]);return(0,n.useImperativeHandle)(t,()=>({reset(){i.current=0,d.current=!0,o||u()},scrollToBottomIfPinned:u,scrollToPercentage:f,enableScrolling:m,getScrollContainer:()=>c.current}),[u,f,m,o]),(0,n.useLayoutEffect)(()=>{s||!r||o||u()},[r,s,u,o]),(0,l.jsx)("div",{className:a,onScroll:e=>{if(s)return;let t=e.currentTarget.scrollTop,a=function(e,t){if(!e)return!1;{let a=e.scrollHeight-8;return Math.ceil(t+e.offsetHeight)>=Math.floor(a)}}(c.current,t),l=t>i.current;a&&l?d.current=!0:a||l||(d.current=!1),i.current=t},ref:c,children:r})});r.displayName="AutoScroll"},56054:(e,t,a)=>{a.d(t,{CodeRenderer:()=>E,k:()=>R,MarkdownRenderer:()=>P});var l=a(54568),n=a(90732),r=a(11727),s=a(78334),o=a(69604),i=a(57820),d=a(80870),c=a(49953),u=a(57291),f=a(49982),m=a(72902),p=a(7620),h=a(29820),g=a(74813),v=a(89626),y=a(23812),x=a(47592),b=a(39109),w=a(61295),C=a(10369),j=a(59666);let k=e=>{let{isStreaming:t,children:a,...n}=e;return t?a:(0,l.jsx)(S,{...n,children:a})},S=e=>{let{children:t,sendMessage:a,contentType:n="text",isOpen:r}=e,s=(0,C.A)(),o=(0,g.st)(),i=void 0!==a,[d,c]=(0,p.useState)([]),[u,f]=(0,p.useState)({top:0,left:0,width:0}),[h,k]=(0,p.useState)(!1),[S,M]=(0,p.useState)(!1),[N,A]=(0,p.useState)(""),[R,E]=(0,p.useState)(""),[P,T]=(0,p.useState)(!1),_=(0,p.useRef)(null),Z=(0,p.useRef)(null),L=(0,p.useCallback)((e,t)=>{var a;let l=function(e,t){let a=[];for(let l=0;l<e.rangeCount;l++){let n=e.getRangeAt(l);if(n.startContainer===n.endContainer&&n.startContainer.nodeType===Node.TEXT_NODE){let e=n.startContainer,t=document.createRange();for(let l=n.startOffset;l<n.endOffset;l++){t.setStart(e,l),t.setEnd(e,l+1);let n=Array.from(t.getClientRects());a.push(...n)}t.detach()}else{let e=function(e){let t,a=[],l=document.createTreeWalker(e.commonAncestorContainer,NodeFilter.SHOW_TEXT,t=>e.intersectsNode(t)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT);for(;t=l.nextNode();)a.push(t);return a}(n);e.forEach((l,r)=>{let s=document.createRange(),o="length"in l?l.length:0,i=0===r,d=r===e.length-1,c=i?n.startOffset:0,u=d&&!t?n.endOffset:o;s.setStart(l,c),s.setEnd(l,u);let f=Array.from(s.getClientRects());a.push(...f),s.detach()})}}return a}(e,t),n=null==(a=_.current)?void 0:a.getBoundingClientRect();return Array.from(l).map(e=>({top:e.top-((null==n?void 0:n.top)||0)-2.5,left:e.left-((null==n?void 0:n.left)||0),width:e.width,height:e.height+5.5}))},[]),O=(0,p.useCallback)(e=>{var t;let a=e.getRangeAt(0);return null==(t=_.current)?void 0:t.contains(a.commonAncestorContainer)},[]);(0,p.useEffect)(()=>{function e(e){var t,a,l,n;let r,s,{selection:o,isSelectAll:i}=e,d=L(o,i);if(d.every((e,t,a)=>0===t||5>Math.abs(e.top-a[0].top))){let e=Math.max(...d.map(e=>e.left+e.width));r=d[0].top-9,s=e+10}else{let e=Math.max(...d.map(e=>e.top+e.height));s=Math.min(...d.map(e=>e.left)),r=Math.min((null!=(l=null==(a=_.current)?void 0:a.scrollHeight)?l:0)-50,e)}let u=((null!=(n=null==(t=_.current)?void 0:t.scrollWidth)?n:1e3)-s)/3*2;c(d),k(!0),M(!1),f({top:r,left:s,width:u}),E(o.toString())}let t=()=>{T(!0)},a=t=>{"Escape"===t.key&&(M(!1),k(!1),A(""),c([]));let a=((0,x.cX)()?t.metaKey:t.ctrlKey)&&"a"===t.key,l=_.current;if(l&&r&&a){let a=document.activeElement&&(document.activeElement===l||(null==l?void 0:l.contains(document.activeElement))),n=window.getSelection();if(a&&n){t.preventDefault();let a=document.createRange();a.selectNodeContents(l),n.removeAllRanges(),n.addRange(a),e({selection:n,isSelectAll:!0})}}},l=t=>{if(Z.current&&Z.current.contains(t.target))return;let a=window.getSelection();a&&!a.isCollapsed&&O(a)?e({selection:a}):(c([]),k(!1),M(!1),E(""),A("")),T(!1)};return i&&(document.addEventListener("mousedown",t),document.addEventListener("mouseup",l),document.addEventListener("keydown",a)),()=>{document.removeEventListener("mousedown",t),document.removeEventListener("mouseup",l),document.removeEventListener("keydown",a)}},[L,O,i,r]);let I=e=>{i&&(a(e),A(""),M(!1),k(!1),c([]))},F=()=>"text"===n?R.split("\n").map(e=>"> ".concat(e)).join("\n"):"code"===n?"```\n".concat(R,"\n```"):void 0,H=()=>{I({prompt:"".concat(F(),"\n\n").concat(N),attachments:[],files:[],syncSources:[]})};return(0,l.jsxs)("div",{className:"w-full h-full relative",children:[(0,l.jsx)("div",{ref:_,tabIndex:0,className:(0,m.$)("w-full h-full relative",i?P?"[&_:not(input)::selection]:bg-secondary-000/10":"[&_*::selection]:bg-secondary-000/10":""),children:t}),d.map((e,t)=>(0,l.jsx)("div",{className:"absolute pointer-events-none bg-accent-secondary-000/10",style:{top:e.top,left:e.left,width:e.width,height:e.height}},t)),(0,l.jsx)(b.N,{children:h&&!S&&(0,l.jsx)(w.P.div,{className:"absolute z-10",initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},transition:{type:"spring",damping:30,stiffness:400,delay:.2},style:{top:u.top+5,left:u.left},children:(0,l.jsx)("div",{className:"border-0.5 flex items-center rounded-lg px-2 pb-1 pt-3 shadow transition bg-bg-000 text-text-400 border-border-300",children:(0,l.jsxs)("div",{className:"-mx-1 -mt-2 flex items-stretch justify-between gap-0.5",children:[(0,l.jsx)(y.$,{variant:"ghost",size:"sm",className:"!font-base",onClick:()=>{o.track({event_key:"artifactinlinefeedback.selection.clicked",source:"improve"}),M(!0)},prepend:(0,l.jsx)(v.XGh,{}),children:(0,l.jsx)(j.A,{defaultMessage:"Improve",id:"BATKcMm/a2"})}),(0,l.jsx)(y.$,{variant:"ghost",size:"sm",className:"!font-base",onClick:()=>{o.track({event_key:"artifactinlinefeedback.selection.clicked",source:"explain"}),I({prompt:"".concat(s.formatMessage({defaultMessage:"Can you explain this section to me in more detail?",id:"LMDbiRxyDQ"}),"\n\n").concat(F()),attachments:[],files:[],syncSources:[]})},prepend:(0,l.jsx)(v.g5W,{}),children:(0,l.jsx)(j.A,{defaultMessage:"Explain",id:"HGdgPPM2Ry"})})]})})})}),(0,l.jsx)(b.N,{children:S&&(0,l.jsxs)(w.P.form,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},transition:{type:"spring",damping:30,stiffness:400},className:"z-10 absolute flex gap-2 p-2 pl-4 items-center h-12 rounded-lg bg-bg-000 text-text-200 border border-0.5 border-border-300 shadow-xl",style:{top:u.top+5,left:u.left,width:u.width},ref:Z,onSubmit:e=>{e.preventDefault(),H()},children:[(0,l.jsx)("input",{type:"text",value:N,onChange:e=>A(e.target.value),placeholder:s.formatMessage({defaultMessage:"Describe what you would like to update...",id:"smio7jldoW"}),className:"py-0.5 px-0 border-0 bg-transparent text-sm grow !shadow-none text-text-200 placeholder-text-500 hide-focus-ring",autoFocus:!0}),(0,l.jsx)(b.N,{children:N.trim().length>0?(0,l.jsx)(w.P.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},transition:{type:"spring",damping:30,stiffness:400,delay:0},children:(0,l.jsx)(y.$,{onClick:()=>H(),"aria-label":s.formatMessage({defaultMessage:"Send Message",id:"yJAKR0Ngpn"}),type:"submit",children:(0,l.jsx)("div",{className:"flex items-center gap-2 select-none",children:(0,l.jsx)(j.A,{defaultMessage:"Update",id:"BWpuKlRSA1"})})})}):null})]})})]})};var M=a(4262),N=a(46879);let A="opacity-30 blur-[2px]",R=e=>{let{isOpen:t,content:a,language:n,citations:r,type:s,showRaw:o,richSandboxRef:i,isCurrentStreaming:d,isChatStreaming:f,onSandboxConfirmation:h,onDOMContentLoaded:g,sendMessage:v,richSandboxCapabilities:y,isLatestVersion:x,artifactId:b,artifactContext:w,artifactVersion:C,onArtifactRuntimeError:j,artifact:k,hasMenuOpen:S,zoom:R,onTrackInteraction:_,showLoginModal:Z,ArtifactMcpModal:L}=e,O=void 0!==s&&void 0!==a&&s!==u.vU.Code&&s!==u.vU.Markdown,I=(0,p.useRef)(null),F=O&&!o,[H,D]=(0,p.useState)(null),U=(0,p.useCallback)(e=>{void 0!==b&&void 0!==C&&(void 0!==j&&j(e),D({error:e,artifactId:b,artifactVersion:C}))},[b,C,j]);(0,p.useEffect)(()=>{var e;if(!k||!d)return;let t=k.versions[k.versions.length-1],a=k.versions[k.versions.length-2];if(!a||!t||"update"!==t.command)return;let l=T(a.resultState,t.resultState);-1!==l&&(null==(e=I.current)||e.scrollToPercentage(l/100))},[a,k,d]),(0,p.useEffect)(()=>{!d&&I.current&&I.current.enableScrolling()},[d]);let q=(0,p.useCallback)(()=>{D(e=>e&&(e.artifactId!==b||e.artifactVersion!==C)?null:e)},[b,C]),z=(0,p.useCallback)(()=>{D(null)},[]);return(0,l.jsxs)(l.Fragment,{children:[O&&(0,l.jsxs)("div",{className:(0,m.A)("ease-out duration-200",F?"h-full w-full relative border-none":"absolute opacity-0 w-0 h-0 overflow-hidden pointer-events-none",S&&A),children:[(0,l.jsx)(N.A,{ref:i,className:F?"h-full w-full border-none bg-bg-100":"absolute opacity-0 w-0 h-0 overflow-hidden pointer-events-none",content:F?a:void 0,type:F?s:void 0,onSandboxConfirmation:h,onDOMContentLoaded:g,capabilities:y,onReportError:U,onSetContent:q,onRefresh:z,externalLinkBehavior:"ask",zoom:R,onTrackInteraction:_,showLoginModal:Z,artifactContext:w,ArtifactMcpModal:L,isChatStreaming:f}),F&&H&&(0,l.jsx)(M.i,{error:H,handleClose:()=>D(null),sendMessage:x?v:void 0,isStreaming:f})]}),void 0===a||void 0===s?null:s===u.vU.Code||o?(0,l.jsx)(c.Z,{noDefaultScroll:!d,ref:I,className:(0,m.A)("ease-out duration-200","relative flex w-full flex-1 overflow-x-auto overflow-y-scroll",S&&A),children:(0,l.jsx)(E,{content:a,isStreaming:f,language:n,sendMessage:v,isOpen:t},"code-".concat(b,"-").concat(C,"-").concat(d))}):s===u.vU.Markdown?(0,l.jsx)(c.Z,{noDefaultScroll:!d,ref:I,className:(0,m.A)("ease-out duration-200","relative flex w-full flex-1 overflow-x-auto overflow-y-scroll",S&&A),children:(0,l.jsx)(P,{content:a,citations:r,isStreaming:f,sendMessage:v,isOpen:t},"markdown-".concat(b,"-").concat(C,"-").concat(d))}):null]})},E=e=>{let{content:t,isStreaming:a,language:s,sendMessage:o,isOpen:c}=e,{codeStyle:u}=(0,i.V)(),{exceedsSizeLimit:f}=(0,d.y)(t),m="code-block__code !my-0 h-fit min-h-full w-fit min-w-full !rounded-none !text-sm !leading-relaxed ";return(0,l.jsx)(k,{isStreaming:a,sendMessage:o,contentType:"code",isOpen:c,children:f?(0,l.jsx)(n.R,{code:t,codeClassName:"".concat(m," p-3.5")}):(0,l.jsx)(h.A,{className:m,language:s,PreTag:"div",style:u,renderer:r.G,children:t})})},P=e=>{let{content:t,citations:a,isStreaming:n,sendMessage:r,isOpen:i}=e,d=(0,f.n)(),c=(0,p.useMemo)(()=>d&&a&&a.length>0?(0,o.k0)(a,t):t,[t,a,d]);return(0,l.jsx)(k,{isStreaming:n,sendMessage:r,isOpen:i,children:(0,l.jsxs)("div",{tabIndex:0,id:"markdown-artifact",className:"font-claude-response mx-auto w-full max-w-3xl leading-[1.65rem] px-6 pt-4 md:pt-6 md:px-11",children:[(0,l.jsx)(s.fP,{text:c,blockCitations:a,className:"!gap-3.5",isStreaming:n,normalizationMode:"markdown-document"}),(0,l.jsx)("div",{className:"h-8"})]})})},T=(e,t)=>{if(!e||!t)return -1;let a=e.replace(/\\n/g,"\n"),l=t.replace(/\\n/g,"\n"),n=[...a].findIndex((e,t)=>e!==l[t]);if(-1===n&&a.length===l.length)return -1;let r=(a.slice(0,-1===n?a.length:n).match(/\n/g)||[]).length,s=(a.match(/\n/g)||[]).length;return s?Math.round(r/s*100):-1}}}]);