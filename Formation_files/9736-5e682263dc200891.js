"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9736],{8019:(e,t,n)=>{n.d(t,{b:()=>a});let a=()=>void 0===crypto.randomUUID?"".concat(1e7,"-",1e3,"-",4e3,"-",8e3,"-",1e11).replace(/[018]/g,e=>{let t=parseInt(e);return(t^crypto.getRandomValues(new Uint8Array(1))[0]&15>>t/4).toString(16)}):crypto.randomUUID()},19736:(e,t,n)=>{n.d(t,{sk:()=>Q,dy:()=>w,Rs:()=>X,Fn:()=>U,CW:()=>K,bT:()=>k,t7:()=>Y,Vt:()=>z,WZ:()=>R,uE:()=>b,OZ:()=>W,$z:()=>C,O2:()=>M,mz:()=>L,FG:()=>x,Bq:()=>q,EV:()=>S,Lo:()=>A,_W:()=>P,yu:()=>E,HA:()=>F,x6:()=>B,HF:()=>G,of:()=>T,Pt:()=>H,HI:()=>I,Du:()=>O,wR:()=>Z,aC:()=>N,gG:()=>D,lj:()=>J});var a=n(74813),r=n(1613),i=n(64328),u=n(98944),o=n(41473),s=n(80688),l=n(68067),c=n(7620);function d(e){let t=JSON.stringify(e);return(0,c.useMemo)(()=>e,[t])}var y=n(8019),v=n(56929),g=n(4869),h=n(69950),p=n(20795),_=n.n(p),f=n(27541),m=n(37380);let C=e=>{let t=(0,g.useQueryClient)(),{activeOrganization:n}=(0,i.YL)(),a=null==n?void 0:n.uuid,[r,u]=(0,c.useReducer)(e=>e+1,0),o=d([s.fC,{orgUuid:a},{uuid:e}]),l=(0,c.useMemo)(()=>t.getQueryData(o),[t,o,e,r]);return(0,c.useEffect)(()=>t.getQueryCache().subscribe(e=>{"updated"===e.type&&"success"===e.action.type&&(0,h.MK)({queryKey:o},e.query)&&u()}),[t,u,o]),{data:l}},L=e=>{let t=(0,g.useQueryClient)(),{activeOrganization:n}=(0,i.YL)(),a=null==n?void 0:n.uuid,r=d([s.fC,{orgUuid:a},{uuid:e}]);return t.getQueryData(r)},Q=30,w=1e4,S=e=>{let{limit:t,offset:n,enabled:a=!0,starred:u,searchQuery:o}=e,{activeOrganization:l}=(0,i.YL)(),c=null==l?void 0:l.uuid,d=new URLSearchParams;void 0!==t&&d.append("limit",t.toString()),void 0!==n&&d.append("offset",n.toString()),void 0!==u&&d.append("starred",u.toString()),void 0!==o&&d.append("searchQuery",o);let y=d.toString();return y=y?"?".concat(y):"",(0,r.Sk)("/api/organizations/".concat(null!=c?c:"","/chat_conversations").concat(y),{queryKey:[s.DC,{orgUuid:c},{limit:t,offset:n,starred:u,searchQuery:o}],staleTime:3e5,enabled:!!c&&a})},U=()=>{let{activeOrganization:e}=(0,i.YL)(),t=null==e?void 0:e.uuid;return(0,r.Sk)("/api/organizations/".concat(t,"/chat_conversations/count_all"),{queryKey:[s.Ad,{orgUuid:t}],staleTime:3e5,enabled:!!t,meta:{noToast:!0}})},b=()=>{let{activeOrganization:e}=(0,i.YL)(),t=(0,r.mn)();return(0,c.useCallback)(async n=>{let{limit:a,offset:r}=n,i=new URLSearchParams;void 0!==a&&i.append("limit",a.toString()),void 0!==r&&i.append("offset",r.toString());let u=i.toString();return u=u?"?".concat(u):"",(await t("/api/organizations/".concat(null==e?void 0:e.uuid,"/chat_conversations").concat(u))).json()},[null==e?void 0:e.uuid,t])},T=()=>{let e=(0,c.useRef)(null),{activeOrganization:t}=(0,i.YL)(),n=null==t?void 0:t.uuid,a=(0,g.useQueryClient)(),u=(0,r.mn)(),o=(0,l.fS)("claude_ai_prefetch");return(0,c.useCallback)(t=>{if(!n||!t||t.startsWith("session_")||!o)return;if("undefined"!=typeof navigator&&"connection"in navigator&&navigator.connection){let e=navigator.connection;if("slow-2g"===e.effectiveType||"2g"===e.effectiveType||"3g"===e.effectiveType||void 0!==e.downlink&&e.downlink<1.5||e.saveData)return}let r=[s.fC,{orgUuid:n},{uuid:t}];if(a.isFetching({queryKey:r}))return;e.current&&e.current.abort(),e.current=new AbortController;let i=e.current,l="/api/organizations/".concat(n,"/chat_conversations/").concat(t,"?tree=True&rendering_mode=messages&render_all_tools=true"),c=()=>{a.prefetchQuery({queryKey:r,queryFn:async()=>{try{let e=await u(l,{signal:i.signal}),t=await e.json();return(0,m.H6)(t)}catch(e){if(e instanceof Error&&"AbortError"===e.name)return;throw e}},staleTime:3e5}).catch(e=>{if(!(e instanceof Error)||"AbortError"!==e.name)throw e})};"undefined"!=typeof requestIdleCallback?requestIdleCallback(c):c()},[n,o,a,u])},q=function(e){let{suppressError:t,enabled:n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{enabled:!0},{activeOrganization:a}=(0,i.YL)(),u=null==a?void 0:a.uuid,o=(0,c.useRef)([]),l=(0,g.useQueryClient)(),d=e.startsWith("session_"),y="/api/organizations/".concat(null!=u?u:"","/chat_conversations/").concat(e,"?tree=True&rendering_mode=messages&render_all_tools=true"),v=(0,r.Sk)(y,{queryKey:[s.fC,{orgUuid:u},{uuid:e}],staleTime:3e5,enabled:!!u&&!!e&&n&&!d,meta:{noToast:t}},t=>(l.invalidateQueries({queryKey:[s.XF,{orgUuid:u,conversationUuid:e}]}),(0,m.H6)(t))),h=(0,c.useMemo)(()=>{if(!v.data)return o.current=[],o.current;let e=(0,m.$)(v.data);return(e.length!==o.current.length||e.some((e,t)=>{var n;return e.uuid!==(null==(n=o.current[t])?void 0:n.uuid)||!_()(e,o.current[t])}))&&(o.current=e),o.current},[v.data]);return{...v,currentPath:h}},P=e=>{let t=(0,g.useQueryClient)(),{activeOrganization:n}=(0,i.YL)(),a=null==n?void 0:n.uuid;return(0,c.useCallback)(()=>{t.invalidateQueries({queryKey:[s.fC,{orgUuid:a},{uuid:e}]})},[t,a,e])},k=(e,t)=>{let{mutateAsync:n}=K(),a=(0,f.useRouter)(),r=t||(0,y.b)();return(0,c.useCallback)(function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{model:void 0,controlsOpen:!1},i={uuid:r,name:"",model:t.model};t.createMode&&(i.create_mode=t.createMode),t.projectUuid&&(i.project_uuid=t.projectUuid),n(i).then(()=>{let n="/chat/".concat(r).concat(t.controlsOpen?"?controls=1":"");a[e](n)}).catch(e=>{(0,v.Cp)(e)})},[n,a,e,r])},K=()=>{let{activeOrganization:e}=(0,i.YL)(),t=null==e?void 0:e.uuid,n=(0,g.useQueryClient)();return(0,r.L2)("/api/organizations/".concat(null!=t?t:"","/chat_conversations"),"POST",{enabled:!!t,onSuccess:e=>{let a;n.setQueryData((a=e.uuid,[s.fC,{orgUuid:t},{uuid:a}]),t=>({...t||{},...e,chat_messages:(null==t?void 0:t.chat_messages)||[],messageByUuid:new Map,parentByChildUuid:new Map,childrenByParentUuid:new Map,selectedChildByUuid:new Map})),V(n,t)}})},Y=()=>{let{activeOrganization:e}=(0,i.YL)(),t=null==e?void 0:e.uuid,n=(0,g.useQueryClient)();return(0,r.Qv)(e=>{let{uuid:n}=e;return"/api/organizations/".concat(null!=t?t:"","/chat_conversations/").concat(n)},"DELETE",(e,t)=>{let{uuid:n}=e;if(!t)return[];let a=t.findIndex(e=>e.uuid===n);if(!(a>-1))return t;{let e=[...t];return e.splice(a,1),e}},{enabled:!!t,queryKey:[s.DC,{orgUuid:t}],onSuccess:async(e,a)=>{let{uuid:r,projectUuid:i}=a;await n.invalidateQueries({queryKey:[s.fC,{orgUuid:t},{uuid:r}]}),i&&await n.invalidateQueries({queryKey:[s.yF,{orgUuid:t,projectUuid:i}]}),await V(n,t)}})},z=e=>{let{activeOrganization:t}=(0,i.YL)(),n=null==t?void 0:t.uuid,a=(0,g.useQueryClient)();return(0,r.L2)("/api/organizations/".concat(n,"/chat_conversations/delete_many"),"POST",{onSuccess:async t=>{await V(a,n),e&&e(t)}})},B=e=>{let{activeOrganization:t}=(0,i.YL)(),n=null==t?void 0:t.uuid,a=(0,g.useQueryClient)();return(0,r.L2)("/api/organizations/".concat(n,"/chat_conversations/move_many"),"POST",{onSuccess:async t=>{await V(a,n);let r=t.moved.map(e=>a.invalidateQueries({queryKey:[s.fC,{orgUuid:n},{uuid:e}]}));await Promise.all(r),e&&e(t)}})},E=()=>{let{activeOrganization:e}=(0,i.YL)(),t=null==e?void 0:e.uuid;return(0,r.Sk)("/api/organizations/".concat(t,"/shares"),{queryKey:[s._J,{orgUuid:t}],enabled:!!t,staleTime:3e5})},M=e=>{let{activeOrganization:t}=(0,i.YL)(),n=null==t?void 0:t.uuid,a=e.startsWith("session_");return(0,r.Sk)("/api/organizations/".concat(n,"/chat_conversations/").concat(e,"/latest"),{enabled:!!n&&!!e&&!a,queryKey:[s.XF,{orgUuid:n,conversationUuid:e}],staleTime:0,meta:{noToast:!0}},e=>{let{snapshot:t,shareable:n,disabled_reason:a}=e;return{shareable:n,disabled_reason:a,snapshot:t?{...t,chat_messages:t.chat_messages.map(e=>(0,m.XU)(e))}:null}})},x=e=>{let{activeOrganization:t,account:n}=(0,i.YL)(),a=null==t?void 0:t.uuid,u=n&&a?"/api/organizations/".concat(a,"/chat_snapshots/").concat(e,"?rendering_mode=messages&render_all_tools=true"):"/api/chat_snapshots/".concat(e,"?rendering_mode=messages&render_all_tools=true");return(0,r.Sk)(u,{retry:!1,refetchInterval:!1,enabled:!!e,staleTime:0,queryKey:[s.Bn,{orgUuid:a,snapshotUuid:e}]},e=>({...e,chat_messages:e.chat_messages.map(e=>(0,m.XU)(e))}))},O=e=>{let{activeOrganization:t}=(0,i.YL)(),n=null==t?void 0:t.uuid,a=(0,g.useQueryClient)();return(0,r.L2)("/api/organizations/".concat(n,"/chat_conversations/").concat(e,"/share"),"POST",{onSuccess:()=>{a.invalidateQueries({queryKey:[s.XF,{orgUuid:n,conversationUuid:e}]}),a.invalidateQueries({queryKey:[s._J,{orgUuid:n}]}),a.invalidateQueries({queryKey:[s.A2,{orgUuid:n}]})}})},D=(e,t)=>{let{activeOrganization:n}=(0,i.YL)(),a=null==n?void 0:n.uuid,u=(0,g.useQueryClient)();return(0,r.L2)("/api/organizations/".concat(a,"/share/").concat(t),"DELETE",{enabled:!!a&&!!t,meta:{errorMessage:"There was an error while trying to unshare the conversation. Please try again."},onSuccess:()=>{u.invalidateQueries({queryKey:[s.XF,{orgUuid:a,conversationUuid:e}]}),u.invalidateQueries({queryKey:[s._J,{orgUuid:a}]}),u.invalidateQueries({queryKey:[s.A2,{orgUuid:a}]})}})},A=e=>{let{activeOrganization:t}=(0,i.YL)(),n=null==t?void 0:t.uuid;return(0,r.Sk)("/api/organizations/".concat(n,"/artifact-versions/").concat(e),{retry:!1,refetchInterval:!1,enabled:!!e&&!!n,staleTime:0,queryKey:[s.Fz,{artifactVersionUuid:e}]})},F=function(e,t,n){var o,l,c;let d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},{track:y}=(0,a.st)(),v=null!=(l=null==(o=(0,u.B)())?void 0:o.preview_feature_uses_artifacts)&&l,{activeOrganization:h}=(0,i.YL)(),p=null==h?void 0:h.uuid,_=(0,g.useQueryClient)(),f=[s.fC,{orgUuid:p},{uuid:e}];return(0,r.L2)("/api/organizations/".concat(null!=p?p:"","/chat_conversations/").concat(e,"/chat_messages/").concat(null!=(c=t.uuid)?c:"","/chat_feedback"),t.chat_feedback?"PUT":"POST",{enabled:!!p,meta:{errorMessage:"We could not save your feedback. Please try again later."},...d,onSuccess(){for(var a,r,i=arguments.length,u=Array(i),o=0;o<i;o++)u[o]=arguments[o];y({event_key:"claudeai.conversation.feedback.sent",message_uuid:t.uuid,conversation_uuid:e,artifacts_enabled:v,conversationHasArtifacts:n,type:null==(a=t.chat_feedback)?void 0:a.type}),_.invalidateQueries({queryKey:f}),null==(r=d.onSuccess)||r.call(d,...u)}})},j=()=>{let e=(0,g.useQueryClient)(),{activeOrganization:t}=(0,i.YL)(),n=null==t?void 0:t.uuid;return(0,c.useCallback)((t,a)=>{t&&(e.setQueryData([s.fC,{orgUuid:n},{uuid:t}],e=>e&&{...e,...a}),e.setQueriesData({queryKey:[s.DC,{orgUuid:n}]},e=>null==e?void 0:e.map(e=>e.uuid!==t?e:{...e,...a})))},[n,e])},I=e=>{let t=(0,g.useQueryClient)(),{activeOrganization:n}=(0,i.YL)(),a=null==n?void 0:n.uuid,u=j();return(0,r.L2)("/api/organizations/".concat(a,"/chat_conversations/").concat(e),"PUT",{onMutate:n=>{var r;let{name:i}=n,o=t.getQueryData([s.fC,{orgUuid:a},{uuid:e}]);return u(e,{name:i}),{oldTitle:null!=(r=null==o?void 0:o.name)?r:""}},onError(t,n,a){a&&u(e,{name:a.oldTitle})}})},R=e=>{let{activeOrganization:t}=(0,i.YL)(),n=null==t?void 0:t.uuid,a=j();return(0,r.L2)("/api/organizations/".concat(n,"/chat_conversations/").concat(e,"/model_fallback"),"PUT",{onSuccess:t=>{a(e,{model:t.model})}})},W=e=>{let t=j(),{activeOrganization:n}=(0,i.YL)();return(0,r.L2)("/api/organizations/".concat(null==n?void 0:n.uuid,"/chat_conversations/").concat(e,"/title"),"POST",{onSuccess(n){let{title:a}=n;t(e,{name:null!=a?a:""})},meta:{noToast:!0}})};function X(e){var t,n;let a=(0,o.C)(e),r=e.attachments.map(e=>e.extracted_content).join(" ");return a+" "+r+" "+((null==(t=e.content)?void 0:t.filter(e=>"tool_use"===e.type).map(e=>e.input?JSON.stringify(e.input):e.partial_json||"").join(" "))||"")+" "+((null==(n=e.content)?void 0:n.filter(e=>"tool_result"===e.type).flatMap(e=>e.content.filter(e=>"text"===e.type).map(e=>e.text)).join(" "))||"")}let N=e=>{let{activeOrganization:t}=(0,i.YL)(),n=null==t?void 0:t.uuid;return(0,r.L2)("/api/organizations/".concat(n,"/chat_conversations/").concat(e,"/stop_response"),"POST")},H=()=>{let{activeOrganization:e}=(0,i.YL)(),t=null==e?void 0:e.uuid;return(0,r.L2)(e=>{let{conversation_uuid:n}=e;return"/api/organizations/".concat(t,"/chat_conversations/").concat(n,"/tool_result")},"POST",{enabled:!!t,meta:{errorMessage:"We could not record the tool result. Please try again later."},transformVariables:e=>{let{conversation_uuid:t,...n}=e;return n}})},J=e=>{let{activeOrganization:t}=(0,i.YL)(),n=null==t?void 0:t.uuid;return(0,r.L2)("/api/organizations/".concat(n,"/chat_conversations/").concat(e,"/current_leaf_message_uuid"),"PUT")},G=(e,t)=>{let{activeOrganization:n}=(0,i.YL)(),a=(0,g.useQueryClient)(),u=null==n?void 0:n.uuid;return(0,r.Qv)("/api/organizations/".concat(u,"/chat_conversations/").concat(e,"?rendering_mode=raw"),"PUT",(e,t)=>t?{...t,settings:{...t.settings,...e.settings}}:void 0,{enabled:!!e,onSuccess:()=>{V(a,u)},onSettled:()=>{(null==t?void 0:t.refetchOnSettled)&&a.refetchQueries({queryKey:[s.fC,{orgUuid:u},{uuid:e}]})},queryKey:[s.fC,{orgUuid:u},{uuid:e}]})},V=async(e,t)=>{await Promise.all([e.invalidateQueries({queryKey:[s.DC,{orgUuid:t}]}),e.invalidateQueries({queryKey:[s.Ad,{orgUuid:t}]})])},Z=e=>{let{activeOrganization:t}=(0,i.YL)(),n=(0,g.useQueryClient)(),a=null==t?void 0:t.uuid;return(0,r.Qv)("/api/organizations/".concat(a,"/chat_conversations/").concat(e,"?rendering_mode=raw"),"PUT",(e,t)=>t?{...t,...e}:void 0,{onSuccess:()=>{V(n,a)},queryKey:[s.fC,{orgUuid:a},{uuid:e}]})}},37380:(e,t,n)=>{n.d(t,{$:()=>p,AP:()=>d,B6:()=>u,EL:()=>o,GN:()=>l,Gp:()=>c,H6:()=>v,XU:()=>y,ZQ:()=>g,gF:()=>s,gX:()=>_,xQ:()=>h});var a=n(56929),r=n(76744),i=n.n(r);let u="new-assistant-message-uuid",o="new-human-message-uuid",s="00000000-0000-4000-8000-000000000000",l=e=>!e.startsWith(u);function c(e,t){let n=e.get(t);if(void 0===n){let e=Error("Key not found: ".concat(t));throw(0,a.Cp)(e),e}return n}let d=(e,t)=>{let n=null!=t?t:e.current_leaf_message_uuid;if(!n)return e;let r=new Set;for(;n!==s;){var i;if(r.has(n)){let e=Error("Circular reference detected in message tree at UUID: ".concat(n));throw(0,a.Cp)(e),e}r.add(n);let t=c(e.parentByChildUuid,n),u=null==(i=c(e.childrenByParentUuid,t))?void 0:i.indexOf(n);e.selectedChildByUuid.set(t,u),n=t}return{...e,current_leaf_message_uuid:t}},y=e=>e.content?e:{...e,content:[{type:"text",text:e.text||"",citations:[]}]},v=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=new Set;for(let t of e.chat_messages)"assistant"===t.sender&&t.parent_message_uuid&&n.add(t.parent_message_uuid);let a=e.chat_messages.filter(e=>"assistant"===e.sender||n.has(e.uuid)||void 0===e.parent_message_uuid||t),r=e.chat_messages.filter(e=>!a.includes(e)&&"human"===e.sender),i={...e,chat_messages:a},u={...i,...(e=>{var t,n,a;let r=new Map,i=new Map,u=new Map,o=new Map,l=new Map;if(0===e.chat_messages.length)return{messageByUuid:i,parentByChildUuid:u,childrenByParentUuid:o,selectedChildByUuid:l};let c=e.chat_messages.map(y);for(let e of c)r.set(e.index,e),i.set(e.uuid,e);for(let e of c){let t=e.parent_message_uuid;if(!t){let a=e.index-1;for(;!t&&a>=0;)t=null==(n=r.get(a))?void 0:n.uuid,a--}t=null!=t?t:s,u.set(e.uuid,t),o.set(t,(null!=(a=o.get(t))?a:[]).concat(e.uuid)),l.set(t,0)}if(!(null==(t=o.get(s))?void 0:t[0]))throw Error("No root message found");return{chat_messages:c,messageByUuid:i,parentByChildUuid:u,childrenByParentUuid:o,selectedChildByUuid:l}})(i),danglingHumanMessages:r};return u.current_leaf_message_uuid||d(u),d(u,i.current_leaf_message_uuid)},g=e=>{let t=Array.from(e.messageByUuid.values()).map(e=>e.index);return 0===t.length?-1:Math.max(...t)},h=(e,t)=>{for(let a of(e.chat_messages=e.chat_messages.concat(t),t)){var n;if(!a.parent_message_uuid)throw Error("Parent UUID required");let t=a.parent_message_uuid;e.messageByUuid.set(a.uuid,a),e.parentByChildUuid.set(a.uuid,t);let r=null!=(n=e.childrenByParentUuid.get(t))?n:[];r.push(a.uuid),e.childrenByParentUuid.set(t,r),e.selectedChildByUuid.set(t,r.length-1)}return d(e,t[t.length-1].uuid)},p=(e,t)=>{let n=[],a=null!=t?t:s;for(;e.childrenByParentUuid.has(a);){let t=c(e.childrenByParentUuid,a);if(0===t.length)break;let r=c(e.selectedChildByUuid,a),i=c(e.messageByUuid,t[r]);n.push({...i,parent_message_uuid:a,nOptions:t.length,selectedOption:r}),a=i.uuid}return n};function _(e,t,n){var a;let r=c(e.parentByChildUuid,t.uuid),u=c(e.childrenByParentUuid,r),o=i()((null!=(a=t.selectedOption)?a:0)+n,0,u.length-1);e.selectedChildByUuid.set(r,o);let s=p(e,r);return d(e,s[s.length-1].uuid)}},41473:(e,t,n)=>{n.d(t,{C:()=>a});let a=e=>{let t="";if(e.content)for(let n of e.content)"text"===n.type&&(t+=n.text);return t}},98944:(e,t,n)=>{n.d(t,{B:()=>u,N:()=>o});var a=n(54568),r=n(7620);let i=(0,r.createContext)(null),u=()=>{let e=(0,r.useContext)(i);return void 0===e?null:e},o=e=>{let{children:t,settings:n}=e;return(0,a.jsx)(i.Provider,{value:n,children:t})}}}]);