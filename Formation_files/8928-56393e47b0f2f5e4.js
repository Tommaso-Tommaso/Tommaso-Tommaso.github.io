"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8928],{11258:(e,t,r)=>{function o(e,t,r,o,a){var n,s,i,c;if(!r||!o)return;let u=null==(n=r.success)||n,l=null==(s=o.success)||s;if(u!==l)return void a({event_key:"mcp.shadow.comparison",server_uuid:e,capability:t,match:!1,websocket_count:r.count,bootstrap_count:o.count,websocket_duration_ms:r.duration_ms,bootstrap_duration_ms:o.duration_ms});if(!u&&!l)return;let p=null!=(i=r.count)?i:0,d=null!=(c=o.count)?c:0;(0!==p||0!==d)&&a({event_key:"mcp.shadow.comparison",server_uuid:e,capability:t,match:p===d,websocket_count:r.count,bootstrap_count:o.count,websocket_duration_ms:r.duration_ms,bootstrap_duration_ms:o.duration_ms})}function a(e,t,r,o){var a,n;(null==(a=r.success)||a)&&0!==(null!=(n=r.count)?n:0)&&o({event_key:"mcp.shadow.comparison",server_uuid:e,capability:t,match:!1,websocket_count:r.count,bootstrap_count:0,websocket_duration_ms:r.duration_ms})}r.d(t,{Z:()=>n});let n=(0,r(4211).v)((e,t)=>({toolsData:new Map,promptsData:new Map,resourcesData:new Map,trackFn:null,bootstrapFinished:!1,websocketStartTime:0,setTrackFn:(t,r)=>e({trackFn:t,websocketStartTime:r}),setBootstrapFinished:()=>{e({bootstrapFinished:!0});let r=t();if(r.trackFn){for(let[e,t]of r.toolsData.entries())t.websocket&&!t.bootstrap&&a(e,"tools",t.websocket,r.trackFn);for(let[e,t]of r.promptsData.entries())t.websocket&&!t.bootstrap&&a(e,"prompts",t.websocket,r.trackFn);for(let[e,t]of r.resourcesData.entries())t.websocket&&!t.bootstrap&&a(e,"resources",t.websocket,r.trackFn)}},recordWebsocketTools:(e,r)=>{let n=t(),s=n.toolsData.get(e)||{};!s.websocket&&(s.websocket=r,n.toolsData.set(e,s),n.trackFn&&(s.bootstrap?o(e,"tools",r,s.bootstrap,n.trackFn):n.bootstrapFinished&&a(e,"tools",r,n.trackFn)))},recordWebsocketPrompts:(e,r)=>{let n=t(),s=n.promptsData.get(e)||{};!s.websocket&&(s.websocket=r,n.promptsData.set(e,s),n.trackFn&&(s.bootstrap?o(e,"prompts",r,s.bootstrap,n.trackFn):n.bootstrapFinished&&a(e,"prompts",r,n.trackFn)))},recordWebsocketResources:(e,r)=>{let n=t(),s=n.resourcesData.get(e)||{};!s.websocket&&(s.websocket=r,n.resourcesData.set(e,s),n.trackFn&&(s.bootstrap?o(e,"resources",r,s.bootstrap,n.trackFn):n.bootstrapFinished&&a(e,"resources",r,n.trackFn)))},recordBootstrapTools:(e,r)=>{let a=t(),n=a.toolsData.get(e)||{};!n.bootstrap&&(n.bootstrap=r,a.toolsData.set(e,n),n.websocket&&a.trackFn&&o(e,"tools",n.websocket,r,a.trackFn))},recordBootstrapPrompts:(e,r)=>{let a=t(),n=a.promptsData.get(e)||{};!n.bootstrap&&(n.bootstrap=r,a.promptsData.set(e,n),n.websocket&&a.trackFn&&o(e,"prompts",n.websocket,r,a.trackFn))},recordBootstrapResources:(e,r)=>{let a=t(),n=a.resourcesData.get(e)||{};!n.bootstrap&&(n.bootstrap=r,a.resourcesData.set(e,n),n.websocket&&a.trackFn&&o(e,"resources",n.websocket,r,a.trackFn))}}))},44007:(e,t,r)=>{r.d(t,{u3:()=>y,oQ:()=>b,p9:()=>v});var o=r(64328),a=r(92693),n=r(68067),s=r(56929),i=r(57965),c=r.n(i),u=r(7620);function l(e){var t,r,o,a,n,s,i,c;return{name:e.name,description:null!=(t=e.description)?t:void 0,annotations:e.annotations?{title:null!=(r=e.annotations.title)?r:void 0,readOnlyHint:null!=(o=e.annotations.readOnlyHint)?o:void 0,destructiveHint:null!=(a=e.annotations.destructiveHint)?a:void 0,idempotentHint:null!=(n=e.annotations.idempotentHint)?n:void 0,openWorldHint:null!=(s=e.annotations.openWorldHint)?s:void 0}:void 0,inputSchema:{...e.inputSchema,properties:null!=(i=e.inputSchema.properties)?i:void 0,required:null!=(c=e.inputSchema.required)?c:void 0},displayName:e.displayName,enabledKey:e.enabled_key,alwaysApprovedKey:e.always_approved_key}}function p(e){var t,r,o,a;return{name:e.name,description:null!=(r=e.description)?r:void 0,title:null!=(o=e.title)?o:void 0,arguments:null==(t=e.arguments)?void 0:t.map(e=>{var t,r;return{name:e.name,description:null!=(t=e.description)?t:void 0,required:null!=(r=e.required)?r:void 0}}),_meta:null!=(a=e._meta)?a:void 0,displayName:e.displayName}}function d(e){var t,r,o,a,n,s;return{uri:e.uri,name:e.name,description:null!=(t=e.description)?t:void 0,title:null!=(r=e.title)?r:void 0,mimeType:null!=(o=e.mimeType)?o:void 0,size:null!=(a=e.size)?a:void 0,annotations:null!=(n=e.annotations)?n:void 0,_meta:null!=(s=e._meta)?s:void 0,displayName:e.displayName}}var m=r(35580),_=r(97859),g=r(11258);function y(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];r||(m.eZ.getState().setRemoteIsLoading(!0),_.O.getState().clearServersNeedingWebsocketRetry());let o=Date.now(),n=[],i=()=>{if(0!==n.length){for(let e of n){let n=m.eZ.getState(),s=Date.now()-o;if("server_base"!==e.type||r){if("tools"===e.type){let o=e.tools||[],i=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return e.map(l)}(t?(0,a.M)(o):o);r?g.Z.getState().recordBootstrapTools(e.uuid,{count:i.length,duration_ms:s}):n.setRemoteTools(e.uuid,i)}else if("resources"===e.type){let t=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return e.map(d)}(e.resources);r?g.Z.getState().recordBootstrapResources(e.uuid,{count:t.length,duration_ms:s}):n.setRemoteResources(e.uuid,t)}else if("prompts"===e.type){let t=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return e.map(p)}(e.prompts);r?g.Z.getState().recordBootstrapPrompts(e.uuid,{count:t.length,duration_ms:s}):n.setRemotePrompts(e.uuid,t)}}else{let t={uuid:e.uuid,name:e.name,url:e.url,custom_oauth_client_id:e.custom_oauth_client_id,custom_oauth_client_secret:void 0,created_at:new Date().toISOString(),updated_at:new Date().toISOString(),is_authenticated:e.usedAuthentication};e.connected&&(0,m.nd)(e.uuid)&&(0,m.s$)(e.uuid)&&(0,m.rD)(t),e.connected?(0,m.n3)(e.uuid,e.usedAuthentication):(_.O.getState().addServerNeedingWebsocketRetry(t),n.removeRemoteServer(e.uuid))}}n.length=0}},u=c()(i,300,{leading:!0,trailing:!0}),y=new EventSource("/api/organizations/".concat(e,"/mcp/v2/bootstrap"),{withCredentials:!0});return y.onerror=()=>{u.cancel(),i(),y.close(),r||(m.eZ.getState().setRemoteIsLoading(!1),_.O.getState().clearServersNeedingWebsocketRetry()),(0,s.Cp)(Error("MCP bootstrap stream error"),{tags:{action:"mcp_bootstrap_stream_error",only_shadow:r},extra:{orgUuid:e}})},y.addEventListener("server_list",t=>{try{let{servers:e}=JSON.parse(t.data);if(!r){for(let t of(m.eZ.getState().setRemoteIsLoading(!1),e))if((0,m.nd)(t.uuid)){let e={uuid:t.uuid,name:t.name,url:t.url,custom_oauth_client_id:null,custom_oauth_client_secret:void 0,created_at:new Date().toISOString(),updated_at:new Date().toISOString(),is_authenticated:!1};(0,m.rD)(e)}}}catch(r){(0,s.Cp)(r,{tags:{action:"mcp_bootstrap_stream_server_list_parse"},extra:{orgUuid:e,eventData:t.data}})}}),y.addEventListener("server_base",t=>{try{let e=JSON.parse(t.data);n.push({type:"server_base",...e}),u()}catch(r){(0,s.Cp)(r,{tags:{action:"mcp_bootstrap_stream_server_base_parse"},extra:{orgUuid:e,eventData:t.data}})}}),y.addEventListener("tools",t=>{try{let{server_uuid:e,tools:r}=JSON.parse(t.data);n.push({type:"tools",uuid:e,tools:r}),u()}catch(r){(0,s.Cp)(r,{tags:{action:"mcp_bootstrap_stream_tools_parse"},extra:{orgUuid:e,eventData:t.data}})}}),y.addEventListener("resources",t=>{try{let{server_uuid:e,resources:r}=JSON.parse(t.data);n.push({type:"resources",uuid:e,resources:r}),u()}catch(r){(0,s.Cp)(r,{tags:{action:"mcp_bootstrap_stream_resources_parse"},extra:{orgUuid:e,eventData:t.data}})}}),y.addEventListener("prompts",t=>{try{let{server_uuid:e,prompts:r}=JSON.parse(t.data);n.push({type:"prompts",uuid:e,prompts:r}),u()}catch(r){(0,s.Cp)(r,{tags:{action:"mcp_bootstrap_stream_prompts_parse"},extra:{orgUuid:e,eventData:t.data}})}}),y.addEventListener("completed",()=>{u.cancel(),i(),y.close(),r||m.eZ.getState().setRemoteIsLoading(!1),r&&g.Z.getState().setBootstrapFinished()}),()=>{u.cancel(),y.close()}}let v=()=>(0,n.fS)("mcp_tb_sessions");function b(){let{activeOrganization:e}=(0,o.YL)(),t=null==e?void 0:e.uuid,r=(0,n.fS)("claude_ai_unicode_sanitize_mcp_data"),a=v(),s=(0,n.fS)("mcp_shadow_comparison");(0,u.useEffect)(()=>{if(t){if(s)return y(t,r,!0);else if(a)return y(t,r,!1)}},[a,t,r,s])}},49629:(e,t,r)=>{r.d(t,{J:()=>a});var o=r(16178);function a(e){let t="Unable to add Google Doc.";return e instanceof o.LG&&"access_denied"===e.errorCode?t+=" Please check that link is a valid Google Doc that you have access to.":t+=" "+e.message,t}},96547:(e,t,r)=>{r.d(t,{vW:()=>x,R4:()=>O,qb:()=>E,ll:()=>R,XT:()=>D,eB:()=>F,W3:()=>T,lu:()=>S,p4:()=>A});var o=r(74813),a=r(1613),n=r(64328),s=r(35984),i=r(80688),c=r(68067),u=r(2e3),l=r(4869),p=r(7620),d=r(24407),m=r(44007),_=r(90370),g=r(88775),y=r(44894),v=r(35580);function b(e){let t=window.atob(e),r=new ArrayBuffer(t.length),o=new Uint8Array(r);for(let e=0;e<t.length;e++)o[e]=t.charCodeAt(e);return r}var h=r(49629);let f=d.Ay.object({uuid:d.Ay.string().uuid(),name:d.Ay.string(),url:d.Ay.string(),created_at:d.Ay.string().datetime(),updated_at:d.Ay.string().datetime(),custom_oauth_client_id:d.Ay.string().nullable().optional(),custom_oauth_client_secret:d.Ay.string().nullable().optional(),is_authenticated:d.Ay.boolean().default(!1)});var k=r(86141),w=r(22167);let S=()=>(0,c.fS)("papi_mcp");function F(e,t){let r=S(),o=(0,m.p9)();return(0,a.Sk)("/api/organizations/".concat(e,"/mcp/remote_servers"),{queryKey:[i.lA,e],enabled:!o&&r&&!!e,...t,select:e=>d.z.array(f).parse(e)})}function D(e,t,r){return(0,a.Sk)("/api/organizations/".concat(e,"/mcp/remote_servers/").concat(t),{queryKey:[i.Sm,e,t],enabled:!!e&&!!t,...r,select:e=>f.parse(e)})}function E(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0,{track:n}=(0,o.st)(),s=(0,l.useQueryClient)(),u=(0,m.p9)(),p=(0,c.fS)("claude_ai_unicode_sanitize_mcp_data");return(0,a.L2)("/api/organizations/".concat(e,"/mcp/remote_servers"),"POST",{...t,onSuccess:(o,a,c)=>{var l;u&&((0,v.rD)(o),(0,m.u3)(e,p)),s.invalidateQueries({queryKey:[i.lA,e]}),s.invalidateQueries({queryKey:[i.qE,e]}),null==(l=t.onSuccess)||l.call(t,o,a,c),n({event_key:"claudeai.mcp.create_server",source:r.source,url:o.url,type:"remote"})}})}function R(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=(0,l.useQueryClient)(),n=(0,m.p9)(),s=(0,c.fS)("claude_ai_unicode_sanitize_mcp_data");return(0,a.L2)("/api/organizations/".concat(e,"/mcp/remote_servers/").concat(t),"DELETE",{...r,onSuccess:(a,c,u)=>{var l;(0,v.eg)(t),n?(0,m.u3)(e,s):(o.setQueryData([i.lA,e],e=>{var r;return null!=(r=null==e?void 0:e.filter(e=>e.uuid!==t))?r:[]}),o.invalidateQueries({queryKey:[i.lA,e]})),o.invalidateQueries({queryKey:[i.qE,e]}),null==(l=r.onSuccess)||l.call(r,a,c,u)}})}function T(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=(0,l.useQueryClient)(),n=(0,m.p9)(),s=(0,c.fS)("claude_ai_unicode_sanitize_mcp_data");return(0,a.L2)("/api/organizations/".concat(e,"/mcp/logout/").concat(t),"POST",{...r,onSettled:()=>{(0,v.Ug)(t)},onSuccess:(t,a,c)=>{var u;n?(0,m.u3)(e,s):o.invalidateQueries({queryKey:[i.lA,e]}),o.invalidateQueries({queryKey:[i.qE,e]}),null==(u=r.onSuccess)||u.call(r,t,a,c)}})}function A(e){let t=(0,m.p9)(),{activeOrganization:r}=(0,n.YL)(),o=null==r?void 0:r.uuid;return(0,a.L2)("/api/organizations/".concat(o,"/chat_conversations/").concat(e,"/tool_approval"),"POST",{enabled:!!e&&!!o&&t})}function O(){let{mutateAsync:e}=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=(0,m.p9)(),{activeOrganization:r}=(0,n.YL)(),o=null==r?void 0:r.uuid;return(0,a.L2)("/api/organizations/".concat(o,"/mcp/attach_resource"),"POST",{enabled:t&&!!o,...e})}(),t=z(),r=function(){let{setIsUploadingDriveSync:e}=(0,_.oM)(),{setSyncSourceUuids:t}=(0,g.Jy)(e=>({setSyncSourceUuids:e.setSyncSourceUuids})),r=(0,w.kO)(),o=(0,v.Uz)({type:"remote",url:"https://api.anthropic.com/mcp/gdrive/sse"}),{addError:a}=(0,s.Y)(),n=o.length>0?o[0]:null,{mutate:i}=(0,k.EF)({onMutate:()=>{e(!0)},onSuccess:r=>{t(e=>[...e,r.uuid]),e(!1)},onError:t=>{e(!1),a((0,h.J)(t),{error:t})},meta:{noToast:!0}});return(0,p.useCallback)(e=>{r&&n&&i({sync_source_type:u.v8.MCP_RESOURCES,sync_source_config:{server_uuid:n.uuid,resource:{...e}}})},[i,r,n])}(),{addError:i}=(0,s.Y)(),c=(0,m.p9)(),l=function(){let{addError:e}=(0,s.Y)(),{track:t}=(0,o.st)(),{handleUpload:r}=(0,_.oM)();return(0,p.useCallback)(async(o,a)=>{try{let e=(await (0,v.KU)(o).readResource({uri:a.uri},{timeout:15e3})).contents.map(e=>{let r;return"text"in e?(r=String(e.text),t({event_key:"mcp.resources.read",type:"text",mime_type:e.mimeType})):(r=b(e.blob),t({event_key:"mcp.resources.read",type:"binary",mime_type:e.mimeType})),new File([r],a.name,{type:e.mimeType})});e.length>0&&await r(e)}catch(t){e("Failed to upload resource. You can try again.",{error:t})}},[t,e,r])}(),{setIsUploadingDriveSync:d}=(0,_.oM)();return(0,p.useCallback)(async o=>{let{serverUuid:a,resource:n,onClose:s}=o;if(!c||(0,v.HG)(a,c))return l(a,n);{let o;try{let e=(0,v.KU)(a);o=await e.readResource({uri:n.uri},{timeout:15e3})}catch(e){}try{var u;d(!0);let i=await e({resource:n,server_uuid:a,result:o});(null==(u=n.mimeType)?void 0:u.startsWith("application/vnd.google-apps"))?r(n):t(i),d(!1),null==s||s()}catch(e){d(!1),i("Failed to attach resource. You can try again.",{error:e,errorContext:{tags:{action:"attach_resource"},extra:{serverUuid:a}}})}}},[c,l,d,e,r,t,i])}function x(e){let{mutateAsync:t}=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=(0,m.p9)(),{activeOrganization:r}=(0,n.YL)(),o=null==r?void 0:r.uuid;return(0,a.L2)("/api/organizations/".concat(o,"/mcp/attach_prompt"),"POST",{enabled:t&&!!o,...e})}(),r=z(),{addError:i}=(0,s.Y)(),c=(0,m.p9)(),u=function(e){let{track:t}=(0,o.st)(),{addError:r}=(0,s.Y)(),{handleUpload:a}=(0,_.oM)();return(0,p.useCallback)(async(o,n,s)=>{try{let r=await (0,v.KU)(o).getPrompt({name:n.name,arguments:s},{timeout:15e3});t({event_key:"mcp.prompts.used",argument_count:Object.keys(s).length,assistant_messages:r.messages.filter(e=>"assistant"===e.role).length,user_messages:r.messages.filter(e=>"user"===e.role).length,text_messages:r.messages.filter(e=>"text"===e.content.type).length,image_messages:r.messages.filter(e=>"image"===e.content.type).length});let i=(e,t)=>{let r=e=>{let t=y._F[e];if(!t)throw Error("Unsupported MIME type: ".concat(e));return t},o=e=>"".concat(n.name).concat(t?"_".concat(t):"",".").concat(e);switch(e.content.type){case"text":return new File([e.content.text],o("txt"),{type:"text/plain"});case"image":{let t=r(e.content.mimeType);return new File([b(e.content.data)],o(t),{type:e.content.mimeType})}case"resource":if("text"in e.content.resource){var a;let t=e.content.resource;return new File([t.text],"".concat(t.uri,".txt"),{type:null!=(a=t.mimeType)?a:"text/plain"})}if("blob"in e.content.resource){let t=e.content.resource;if(!t.mimeType)throw Error("Missing MIME type for embedded resource");let o=r(t.mimeType);return new File([b(t.blob)],"".concat(t.uri,".").concat(o),{type:t.mimeType})}throw Error("Invalid resource content");case"audio":throw Error("Audio content not supported");case"resource_link":throw Error("Resource links are not supported")}};if(1===r.messages.length)await a([i(r.messages[0],0)]);else if(r.messages.length>1){let e=r.messages.flatMap((e,t)=>"image"===e.content.type||"resource"===e.content.type&&"blob"in e.content.resource?[i(e,t)]:[]),t=r.messages.filter(e=>"text"===e.content.type||"resource"===e.content.type&&"text"in e.content.resource);if(t.length>0){let r=JSON.stringify(t,null,2);e.push(new File([r],"".concat(n.name,"_messages.json"),{type:"application/json"}))}await a(e)}null==e||e()}catch(e){r("Failed to get prompt. You can try again.",{error:e})}},[t,r,a,e])}(e);return(0,p.useCallback)(async o=>{let{serverUuid:a,prompt:n,args:s}=o;if(!c||(0,v.HG)(a,c))return u(a,n,s);{let o;try{let e=(0,v.KU)(a);o=await e.getPrompt({name:n.name,arguments:s},{timeout:15e3})}catch(e){}try{let i=await t({prompt:n,arguments:s,server_uuid:a,result:o});r(i),null==e||e()}catch(e){i("Failed to attach prompt. You can try again.",{error:e,errorContext:{tags:{action:"attach_prompt"},extra:{serverUuid:a}}})}}},[t,r,i,e,c,u])}function z(){let{setAttachments:e,setFiles:t}=(0,g.Jy)(e=>({setAttachments:e.setAttachments,setFiles:e.setFiles}));return(0,p.useCallback)(r=>{let{files:o,attachments:a}=r;o&&o.length>0&&t(e=>{let t=new Set(e.map(e=>e.file_uuid));return[...e,...o.filter(e=>!t.has(e.file_uuid))]}),a&&a.length>0&&e(e=>Array.from(new Set([...e,...a].map(e=>JSON.stringify(e)))).map(e=>JSON.parse(e)))},[e,t])}d.z.object({name:d.z.string(),url:d.z.string(),custom_oauth_client_id:d.z.string().nullable().optional(),custom_oauth_client_secret:d.z.string().nullable().optional()}),d.z.object({name:d.z.string().optional().nullable(),url:d.z.string().optional().nullable()})},97859:(e,t,r)=>{r.d(t,{O:()=>o});let o=(0,r(4211).v)(e=>({serversNeedingWebsocketRetry:[],addServerNeedingWebsocketRetry:t=>e(e=>({serversNeedingWebsocketRetry:[...e.serversNeedingWebsocketRetry,t]})),clearServersNeedingWebsocketRetry:()=>e({serversNeedingWebsocketRetry:[]})}))}}]);