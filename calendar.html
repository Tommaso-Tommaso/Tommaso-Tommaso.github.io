<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Calendar of Meetings</title>
  <link rel="stylesheet" href="main.css">
</head>
<body>
  <header class="sticky-nav">
    <nav aria-label="Main navigation">
      <div class="nav-container">
        <div class="nav-brand"><a href="index.html">Coastal Community of John of the Cross</a></div>
        <ul class="main-menu">
          <li><a href="index.html">Home</a></li>
          <li class="dropdown"><a href="#" class="dropdown-toggle active">Community Life <span class="dropdown-arrow">▾</span></a></li>
          <li class="dropdown"><a href="#" class="dropdown-toggle">Resources <span class="dropdown-arrow">▾</span></a></li>
          <li class="dropdown"><a href="#" class="dropdown-toggle">Contact <span class="dropdown-arrow">▾</span></a></li>
        </ul>
      </div>
    </nav>
  </header>
  <main>
    <h1>Calendar of Meetings</h1>
    <p>Our community meets on the 4th Friday of each month. Below are calendars for the current month, next month, and the following month. Click a date to see events.</p>
    <p style="background:#fff7e6;border:1px solid #f3d7a6;color:#7a4b00;padding:.65rem .8rem;border-radius:6px;margin:.75rem 0 1rem 0;">
      <strong>Notice:</strong> Nov 8 — Saint Elizabeth memorial, community breakfast after 8.30 Mass.
    </p>
    <div class="calendar-container" id="calendars" style="display:flex;gap:1rem;flex-wrap:wrap;justify-content:center;"></div>
    <section style="margin-top:1.5rem">
      <h2>Monthly Meetings</h2>
      <ul id="event-summary" class="events-list" style="margin-top:0.6rem;font-size:0.9rem;color:#333;text-align:left;"></ul>
      <p id="meeting-note" style="margin-top:0.5rem; font-style:italic;">Friday morning at 9.30 after mass @ Father's Pat Kitchen</p>
    </section>
  </main>
  <script src="scripts/main.js"></script>
  <script>
    (function(){
      const weekdayNames = ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];
      const calendarsRoot = document.getElementById('calendars');
      const eventSummary = document.getElementById('event-summary');
      const events = {};
      const meetingDays = new Set();
      function ymd(y,m,d){
        const mm = String(m+1).padStart(2,'0');
        const dd = String(d).padStart(2,'0');
        return `${y}-${mm}-${dd}`;
      }
      function fourthFridayDate(year, month){
        const firstDayW = new Date(year, month, 1).getDay();
        const offsetToFriday = (5 - firstDayW + 7) % 7;
        const firstFriday = 1 + offsetToFriday;
        return firstFriday + 21;
      }
      function buildCalendar(year, month){
        const container = document.createElement('div');
        container.className = 'calendar';
        container.style.background = '#fff';
        container.style.padding = '1rem';
        container.style.borderRadius = '8px';
        container.style.boxShadow = '0 6px 16px rgba(0,0,0,0.06)';
        container.style.width = '320px';
        const title = document.createElement('div');
        title.className = 'month-title';
        title.style.textAlign = 'center';
        title.style.fontWeight = '700';
        title.style.marginBottom = '0.5rem';
        const monthName = new Date(year, month).toLocaleString(undefined, { month: 'long' });
        title.textContent = `${monthName} ${year}`;
        container.appendChild(title);
        const table = document.createElement('table');
        table.className = 'calendar-table';
        table.style.width = '100%';
        table.style.borderCollapse = 'collapse';
        const thead = document.createElement('thead');
        const headRow = document.createElement('tr');
        weekdayNames.forEach(w => {
          const th = document.createElement('th');
          th.textContent = w;
          th.style.textAlign = 'center';
          th.style.padding = '0.35rem 0';
          th.style.fontWeight = '600';
          th.style.color = '#333';
          headRow.appendChild(th);
        });
        thead.appendChild(headRow);
        table.appendChild(thead);
        const tbody = document.createElement('tbody');
        const firstDay = new Date(year, month, 1).getDay();
        const daysInMonth = new Date(year, month + 1, 0).getDate();
        let row = document.createElement('tr');
        for(let i=0;i<firstDay;i++){
          const td = document.createElement('td');
          td.className = 'empty';
          td.style.color = '#bbb';
          row.appendChild(td);
        }
        const today = new Date();
        for(let day=1, slot=firstDay; day<=daysInMonth; day++, slot++){
          if(slot % 7 === 0){ tbody.appendChild(row); row = document.createElement('tr'); }
          const td = document.createElement('td');
          td.className = 'day';
          td.style.width = '14.285%';
          td.style.height = '48px';
          td.style.textAlign = 'center';
          td.style.verticalAlign = 'top';
          td.style.padding = '6px';
          td.style.borderRadius = '6px';
          const key = ymd(year,month,day);
          td.dataset.date = key;
          td.innerHTML = `<div>${day}</div>`;
          if(year===today.getFullYear() && month===today.getMonth() && day===today.getDate()){
            td.style.background = '#f0e7db';
            td.style.border = '1px solid #e0d6c8';
          }
          if(meetingDays.has(key)){
            td.style.background = '#eef6ff';
            td.style.border = '1px solid #cfe3ff';
            const marker = document.createElement('div');
            marker.style.fontSize = '0.75rem';
            marker.style.marginTop = '4px';
            marker.style.fontWeight = '700';
            marker.textContent = 'M.M.';
            td.appendChild(marker);
          }
          td.addEventListener('click', () => showEventsForDate(key));
          row.appendChild(td);
        }
        while(row.children.length < 7){ const td = document.createElement('td'); td.className = 'empty'; td.style.color = '#bbb'; row.appendChild(td); }
        tbody.appendChild(row);
        table.appendChild(tbody);
        container.appendChild(table);
        return container;
      }
      function showEventsForDate(ymdKey){
        eventSummary.innerHTML = '';
        const list = events[ymdKey];
        const title = document.createElement('li');
        title.style.fontWeight = '700';
        title.textContent = `Events for ${ymdKey}:`;
        eventSummary.appendChild(title);
        if(!list || list.length===0){ const none = document.createElement('li'); none.textContent = 'No events scheduled.'; eventSummary.appendChild(none); return; }
        list.forEach(ev => { const li = document.createElement('li'); li.textContent = ev; eventSummary.appendChild(li); });
      }
      const now = new Date();
      const curY = now.getFullYear();
      const curM = now.getMonth();
      const nextY = (curM===11) ? curY+1 : curY;
      const nextM = (curM===11) ? 0 : curM+1;
      const next2Y = (nextM===11) ? nextY+1 : nextY;
      const next2M = (nextM===11) ? 0 : nextM+1;
      const curFourthFri = fourthFridayDate(curY, curM);
      const nextFourthFri = fourthFridayDate(nextY, nextM);
      const next2FourthFri = fourthFridayDate(next2Y, next2M);
      const curFourthKey = ymd(curY, curM, curFourthFri);
      const nextFourthKey = ymd(nextY, nextM, nextFourthFri);
      const next2FourthKey = ymd(next2Y, next2M, next2FourthFri);
      meetingDays.add(curFourthKey);
      meetingDays.add(nextFourthKey);
      meetingDays.add(next2FourthKey);
      events[curFourthKey] = (events[curFourthKey] || []).concat(['Monthly meeting']);
      events[nextFourthKey] = (events[nextFourthKey] || []).concat(['Monthly meeting']);
      events[next2FourthKey] = (events[next2FourthKey] || []).concat(['Monthly meeting']);
      const elizNov8Key = ymd(curY, 10, 8); // month index 10 = November
      events[elizNov8Key] = (events[elizNov8Key] || []).concat(['Saint Elizabeth memorial, community breakfast after 8.30 Mass']);
      calendarsRoot.appendChild(buildCalendar(curY, curM));
      calendarsRoot.appendChild(buildCalendar(nextY, nextM));
      calendarsRoot.appendChild(buildCalendar(next2Y, next2M));
      const todayKey = ymd(curY,curM,now.getDate());
      showEventsForDate(todayKey);
    })();
  </script>
  <div style="max-width:1100px;margin:0 auto;padding:0 1rem 2rem 1rem;color:#555;font-size:.95rem;">
    <hr style="margin:1.25rem 0;" />
    <p><strong>Legend:</strong> M.M. = Monthly Meetings</p>
    <p><strong>Note:</strong> Nov 8 — Saint Elizabeth memorial, community breakfast after 8.30 Mass.</p>
  </div>
</body>
</html>
